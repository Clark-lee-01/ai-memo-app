# Story 2.7: 노트 정렬 옵션 (최신순, 제목순)

## 📋 스토리 정보

- **Epic:** Epic 2 - 노트 관리 시스템
- **Story ID:** 2.7
- **Story Points:** 3
- **Priority:** P1 (High)
- **Status:** Draft

## 👤 사용자 스토리

**As a** 사용자  
**I want to** 노트 목록을 다양한 기준으로 정렬할 수 있는 옵션을 제공받고 싶다  
**So that** 내가 원하는 방식으로 노트를 정리하고 찾을 수 있다

## 📝 상세 설명

사용자가 노트 목록 페이지에서 노트들을 다양한 기준으로 정렬할 수 있는 기능을 제공합니다. 이를 통해 사용자는 자신의 작업 방식에 맞게 노트를 정리하고 효율적으로 탐색할 수 있습니다.

## ✅ 수용 기준

### 기능 요구사항

1. **정렬 옵션 제공**
   - 최신순 (기본값)
   - 오래된순
   - 제목 오름차순 (A-Z)
   - 제목 내림차순 (Z-A)
   - 수정일 최신순
   - 수정일 오래된순

2. **UI 컴포넌트**
   - 드롭다운 또는 버튼 그룹으로 정렬 옵션 표시
   - 현재 선택된 정렬 기준 명시
   - 직관적인 아이콘과 텍스트로 옵션 구분

3. **상태 관리**
   - 선택된 정렬 기준이 URL 파라미터에 반영
   - 페이지 새로고침 시에도 정렬 상태 유지
   - 브라우저 뒤로가기/앞으로가기 지원

4. **성능 최적화**
   - 정렬 변경 시 즉시 반영 (로딩 상태 표시)
   - 데이터베이스 레벨에서 정렬 처리
   - 불필요한 재렌더링 최소화

### 기술적 요구사항

1. **서버 액션 수정**
   - `getNotes` 함수에 정렬 옵션 파라미터 추가
   - Drizzle ORM의 `orderBy` 기능 활용
   - 정렬 옵션 유효성 검증

2. **UI 컴포넌트**
   - `Select` 또는 `DropdownMenu` 컴포넌트 사용
   - shadcn/ui 디자인 시스템 준수
   - 접근성 고려 (키보드 네비게이션, 스크린 리더)

3. **URL 상태 관리**
   - Next.js `searchParams` 활용
   - 정렬 기준을 URL 쿼리 파라미터로 관리
   - 기본값 처리 및 유효성 검증

## 🎯 사용자 시나리오

### 시나리오 1: 최신순으로 노트 정렬
1. 사용자가 노트 목록 페이지에 접속
2. 기본적으로 최신순으로 노트가 표시됨
3. 사용자가 정렬 드롭다운을 클릭
4. "최신순" 옵션이 선택된 상태로 표시됨

### 시나리오 2: 제목순으로 노트 정렬
1. 사용자가 노트 목록 페이지에 접속
2. 정렬 드롭다운을 클릭
3. "제목 오름차순" 옵션을 선택
4. 노트들이 제목 기준으로 A-Z 순으로 정렬됨
5. URL에 `sortBy=title&sortOrder=asc` 파라미터가 추가됨

### 시나리오 3: 수정일 기준 정렬
1. 사용자가 정렬 드롭다운을 클릭
2. "수정일 최신순" 옵션을 선택
3. 최근에 수정된 노트가 맨 위에 표시됨
4. 페이지를 새로고침해도 정렬 상태가 유지됨

## 🔧 기술적 구현

### 1. 데이터베이스 쿼리 수정

```typescript
// app/actions/notes.ts
export async function getNotes(options: {
  page?: number;
  limit?: number;
  sortBy?: 'createdAt' | 'updatedAt' | 'title';
  sortOrder?: 'asc' | 'desc';
  search?: string;
} = {}) {
  // 정렬 조건 구성
  const orderBy = sortOrder === 'asc' 
    ? asc(notes[sortBy])
    : desc(notes[sortBy]);

  // 노트 목록 조회
  const notesList = await db
    .select()
    .from(notes)
    .where(and(...whereConditions))
    .orderBy(orderBy)
    .limit(limit)
    .offset(offset);
}
```

### 2. UI 컴포넌트 구현

```typescript
// components/notes/note-sort.tsx
export function NoteSort({ 
  currentSort, 
  onSortChange 
}: {
  currentSort: string;
  onSortChange: (sort: string) => void;
}) {
  return (
    <Select value={currentSort} onValueChange={onSortChange}>
      <SelectTrigger className="w-[180px]">
        <SelectValue placeholder="정렬 기준" />
      </SelectTrigger>
      <SelectContent>
        <SelectItem value="createdAt-desc">최신순</SelectItem>
        <SelectItem value="createdAt-asc">오래된순</SelectItem>
        <SelectItem value="title-asc">제목 오름차순</SelectItem>
        <SelectItem value="title-desc">제목 내림차순</SelectItem>
        <SelectItem value="updatedAt-desc">수정일 최신순</SelectItem>
        <SelectItem value="updatedAt-asc">수정일 오래된순</SelectItem>
      </SelectContent>
    </Select>
  );
}
```

### 3. 페이지 컴포넌트 수정

```typescript
// app/notes/page.tsx
export default async function NotesPage({ searchParams }: NotesPageProps) {
  const params = await searchParams;
  const page = parseInt(params.page || '1', 10);
  const sortBy = (params.sortBy as 'createdAt' | 'updatedAt' | 'title') || 'createdAt';
  const sortOrder = (params.sortOrder as 'asc' | 'desc') || 'desc';

  return (
    <div className="container max-w-6xl mx-auto p-6">
      <div className="flex items-center justify-between mb-8">
        <div className="flex items-center gap-4">
          <h1 className="text-3xl font-bold">내 노트</h1>
          <NoteSort 
            currentSort={`${sortBy}-${sortOrder}`}
            onSortChange={handleSortChange}
          />
        </div>
        {/* ... */}
      </div>
      {/* ... */}
    </div>
  );
}
```

## 🧪 테스트 케이스

### 단위 테스트
- [ ] 정렬 옵션 파싱 로직 테스트
- [ ] URL 파라미터 유효성 검증 테스트
- [ ] 정렬 컴포넌트 렌더링 테스트

### 통합 테스트
- [ ] 정렬 변경 시 데이터베이스 쿼리 테스트
- [ ] URL 상태 동기화 테스트
- [ ] 페이지네이션과 정렬 조합 테스트

### E2E 테스트
- [ ] 정렬 옵션 선택 및 결과 확인
- [ ] 브라우저 뒤로가기/앞으로가기 테스트
- [ ] 페이지 새로고침 시 상태 유지 테스트

## 🚫 제외사항

- 복합 정렬 (여러 기준 동시 적용)
- 사용자별 정렬 기본값 설정
- 정렬 기준 커스터마이징
- 정렬 히스토리 저장

## 🔗 의존성

- Story 2.2: 노트 생성 (노트 데이터 존재 필요)
- Story 2.3: 노트 목록 조회 (기본 목록 기능 필요)
- shadcn/ui Select 컴포넌트

## 📅 예상 일정

- **개발:** 1일
- **테스트:** 0.5일
- **총 소요시간:** 1.5일

## ✅ 완료 조건

- [ ] 모든 정렬 옵션이 정상 동작
- [ ] URL 상태 관리가 올바르게 작동
- [ ] UI 컴포넌트가 접근성 기준을 만족
- [ ] 성능 최적화가 적용됨
- [ ] 모든 테스트 케이스 통과

## 📝 개발 노트

- 정렬 옵션은 사용자 경험을 크게 향상시킬 수 있는 기능
- 데이터베이스 레벨에서 정렬을 처리하여 성능 최적화
- URL 상태 관리를 통해 북마크 및 공유 가능
- 향후 검색 기능과의 통합을 고려한 설계 필요

# Story 4.6: 요약/태그 수동 편집 기능

## Status
Ready for Review

## Story
**As a** 사용자,
**I want** AI가 생성한 요약이나 태그를 직접 수정할 수 있도록,
**so that** AI 결과를 사용자만의 관점에서 개선하거나 세부사항을 조정할 수 있다

## Acceptance Criteria
1. 기존 요약이 있을 때 편집 버튼이 표시된다
2. 기존 태그가 있을 때 편집 버튼이 표시된다
3. 요약 편집 시 텍스트 에디터가 표시된다
4. 태그 편집 시 개별 태그를 추가/삭제/수정할 수 있다
5. 편집 중에는 저장/취소 버튼이 표시된다
6. 편집 완료 시 변경사항이 즉시 반영된다
7. 편집 취소 시 원래 상태로 복원된다
8. 편집 중에는 다른 AI 기능이 비활성화된다

## Tasks / Subtasks
- [x] Task 1: 요약 수동 편집 기능 구현 (AC: 1, 3, 5, 6, 7, 8)
  - [x] Subtask 1.1: 요약 편집 모드 토글 기능
  - [x] Subtask 1.2: 요약 텍스트 에디터 구현
  - [x] Subtask 1.3: 요약 저장/취소 기능
  - [x] Subtask 1.4: 요약 편집 상태 관리
- [x] Task 2: 태그 수동 편집 기능 구현 (AC: 2, 4, 5, 6, 7, 8)
  - [x] Subtask 2.1: 태그 편집 모드 토글 기능
  - [x] Subtask 2.2: 태그 추가/삭제/수정 UI
  - [x] Subtask 2.3: 태그 저장/취소 기능
  - [x] Subtask 2.4: 태그 편집 상태 관리
- [x] Task 3: 편집 UI/UX 개선 (AC: 3, 4, 5, 7, 8)
  - [x] Subtask 3.1: 편집 모드 시각적 피드백
  - [x] Subtask 3.2: 편집 중 버튼 상태 관리
  - [x] Subtask 3.3: 편집 완료/취소 확인
  - [x] Subtask 3.4: 편집 중 다른 기능 비활성화
- [x] Task 4: 편집 로직 통합 (AC: 5, 6, 7, 8)
  - [x] Subtask 4.1: 공통 편집 훅 생성
  - [x] Subtask 4.2: 편집 상태 관리 통합
  - [x] Subtask 4.3: 편집 데이터 검증
  - [x] Subtask 4.4: 편집 로깅 및 모니터링
- [x] Task 5: 테스트 작성 (AC: 1-8)
  - [x] Subtask 5.1: 요약 편집 기능 테스트
  - [x] Subtask 5.2: 태그 편집 기능 테스트
  - [x] Subtask 5.3: 편집 UI/UX 테스트
  - [x] Subtask 5.4: 통합 테스트

## Dev Notes

### Previous Story Insights
- 스토리 4.1에서 Gemini API 클라이언트가 완성되어 API 호출 패턴 확정
- 스토리 4.2에서 요약 생성 기능이 완성되어 요약 데이터 구조 확정
- 스토리 4.3에서 태그 생성 기능이 완성되어 태그 데이터 구조 확정
- 스토리 4.4에서 AI 상태 관리 훅이 완성되어 상태 관리 패턴 확정
- 스토리 4.5에서 재생성 기능이 완성되어 재생성 로직 참고 가능

### Data Models
- **편집 상태**: editing, saving, saved, cancelled [Source: 기존 AI 상태 관리 패턴]
- **편집 타입**: summary, tags [Source: 요약/태그 생성 기능]
- **편집 데이터**: 원본 데이터, 편집된 데이터, 변경사항 [Source: 기존 데이터 구조]

### API Specifications
- **요약 업데이트**: 기존 updateNoteSummary 함수 활용 [Source: app/actions/notes.ts]
- **태그 업데이트**: 기존 updateNoteTags 함수 활용 [Source: app/actions/notes.ts]
- **데이터 검증**: 요약/태그 형식 검증 [Source: 기존 검증 로직]

### Component Specifications
- **편집 버튼**: 기존 편집 버튼 개선 및 통일
- **텍스트 에디터**: 요약 편집을 위한 Textarea 컴포넌트
- **태그 에디터**: 태그 추가/삭제/수정을 위한 입력 컴포넌트
- **저장/취소 버튼**: 편집 완료/취소를 위한 버튼 그룹

### File Locations
- **공통 훅**: lib/hooks/useEditing.ts (새로 생성)
- **요약 섹션**: components/notes/summary-section.tsx (수정)
- **태그 섹션**: components/notes/tags-section.tsx (수정)
- **편집 컴포넌트**: components/notes/summary-editor.tsx, components/notes/tags-editor.tsx (새로 생성)
- **테스트**: __tests__/hooks/useEditing.test.ts, __tests__/components/notes/ (수정/생성)

### Testing Requirements
- **테스트 프레임워크**: Jest 사용 [Source: workspace rules]
- **테스트 위치**: __tests__/ 디렉토리
- **단위 테스트**: 편집 훅, UI 컴포넌트
- **통합 테스트**: 실제 편집 시나리오
- **에러 테스트**: 편집 실패 시나리오

### Technical Constraints
- **Next.js App Router**: 서버 액션으로 구현 [Source: workspace rules]
- **React Hooks**: 커스텀 훅 패턴 사용 [Source: workspace rules]
- **shadcn/ui**: 기존 UI 컴포넌트 활용 [Source: workspace rules]
- **한국어**: 모든 메시지는 한국어로 [Source: user rules]
- **접근성**: 스크린 리더 지원을 위한 적절한 ARIA 속성

### Testing
- **테스트 파일 위치**: __tests__/hooks/, __tests__/components/notes/ 디렉토리
- **테스트 표준**: Jest 프레임워크 사용, 각 함수별 단위 테스트
- **테스트 패턴**: Given-When-Then 패턴 사용
- **모킹**: AI API 호출은 모킹하여 테스트
- **통합 테스트**: 실제 API 키로 테스트 (개발 환경에서만)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (2024-12-19)

### Debug Log References
- 서버 액션 테스트에서 validateNoteId 반환값 구조 문제 해결
- 컴포넌트 테스트에서 모킹 방식 개선
- useEditing 훅의 재시도 로직 테스트 수정

### Completion Notes List
- useEditing 커스텀 훅을 생성하여 요약/태그 편집 로직을 통합
- SummaryEditor, TagsEditor 컴포넌트를 생성하여 편집 UI 구현
- SummarySection, TagsSection에 편집 기능 통합
- updateNoteSummary, updateNoteTags 서버 액션 추가
- 편집 중 다른 AI 기능 비활성화 구현
- 변경사항 감지 및 저장/취소 기능 구현
- 편집 상태 관리 및 에러 처리 구현

### File List
- lib/hooks/useEditing.ts (새로 생성)
- components/notes/summary-editor.tsx (새로 생성)
- components/notes/tags-editor.tsx (새로 생성)
- components/notes/summary-section.tsx (수정)
- components/notes/tags-section.tsx (수정)
- app/actions/notes.ts (수정)
- __tests__/hooks/useEditing.test.ts (새로 생성)
- __tests__/components/notes/summary-editor.test.tsx (새로 생성)
- __tests__/components/notes/tags-editor.test.tsx (새로 생성)
- __tests__/actions/notes-editing.test.ts (새로 생성)

## QA Results
*QA 에이전트가 검토 후 채워집니다*

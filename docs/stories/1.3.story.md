# Story 1.3: 비밀번호 재설정

## Status
Ready for Review

## Story

**As a** 등록된 사용자,
**I want** 비밀번호를 재설정할 수 있도록,
**so that** 비밀번호를 잊어버렸을 때 계정에 다시 접근할 수 있다

## Acceptance Criteria

1. 사용자가 이메일 주소를 입력할 수 있는 비밀번호 재설정 요청 폼을 제공한다
2. 이메일 형식 유효성 검사가 실시간으로 작동한다
3. 비밀번호 재설정 이메일이 발송된다
4. 이메일의 링크를 통해 새로운 비밀번호를 설정할 수 있다
5. 새로운 비밀번호는 기존 비밀번호와 동일한 보안 요구사항을 만족해야 한다
6. 모든 에러 상황에 대해 사용자에게 명확한 메시지를 표시한다

## Tasks / Subtasks

- [x] 비밀번호 재설정 요청 UI 구현 (AC: 1, 2, 6)
  - [x] shadcn/ui 기반 비밀번호 재설정 요청 폼 컴포넌트 생성
  - [x] 이메일 입력 필드 및 실시간 유효성 검사
  - [x] 에러 메시지 표시 컴포넌트
- [x] 비밀번호 재설정 요청 서버 액션 구현 (AC: 3, 6)
  - [x] Supabase Auth resetPasswordForEmail 함수 호출
  - [x] 에러 핸들링 및 사용자 피드백
- [x] 비밀번호 재설정 페이지 구현 (AC: 1, 4)
  - [x] 비밀번호 재설정 요청 페이지 라우트 생성
  - [x] 로그인 페이지로의 링크 제공
  - [x] 성공/실패 메시지 표시
- [x] 새 비밀번호 설정 UI 구현 (AC: 4, 5, 6)
  - [x] 새 비밀번호 입력 폼 컴포넌트 생성
  - [x] 비밀번호 확인 입력 필드
  - [x] 비밀번호 보안 요구사항 검사 (영문자, 숫자, 특수문자)
- [x] 새 비밀번호 설정 서버 액션 구현 (AC: 4, 5, 6)
  - [x] Supabase Auth updateUser 함수 호출
  - [x] 비밀번호 유효성 검사
  - [x] 에러 핸들링 및 사용자 피드백
- [x] 테스트 작성 (AC: 1, 2, 3, 4, 5, 6)
  - [x] 비밀번호 재설정 요청 폼 테스트
  - [x] 새 비밀번호 설정 폼 테스트
  - [x] 서버 액션 통합 테스트

## Dev Notes

### 기술 스택 정보
[Source: architecture.md#1]
- **프레임워크:** Next.js (App Router, Server Actions)
- **UI:** shadcn/ui + Tailwind + Radix UI
- **DB/인증:** Supabase (Postgres, Auth, Storage)
- **호스팅:** Vercel (Preview/Prod)

### 보안 요구사항
[Source: architecture.md#3]
- **키 관리:** Supabase 서비스 롤 키는 서버 전용
- **권한 스코프:** 사용자 ID 스코프로 데이터 격리 보장

### 프로젝트 구조
- **앱 구조:** Next.js App Router 사용 (`/app` 디렉토리)
- **서버 로직:** Server Actions으로 구현
- **UI 컴포넌트:** shadcn/ui 컴포넌트 활용
- **스타일링:** Tailwind CSS 사용

### Supabase Auth 설정
- Supabase Auth를 통한 비밀번호 재설정 플로우
- 이메일 기반 비밀번호 재설정 토큰 발송
- 보안 토큰을 통한 비밀번호 업데이트

### 파일 위치
- 비밀번호 재설정 요청 페이지: `/app/auth/reset-password/page.tsx`
- 새 비밀번호 설정 페이지: `/app/auth/reset-password/confirm/page.tsx`
- 비밀번호 재설정 요청 폼: `/components/auth/reset-password-form.tsx`
- 새 비밀번호 설정 폼: `/components/auth/new-password-form.tsx`
- 서버 액션: `/app/actions/auth.ts` (기존 파일 확장)

### Testing
- **테스트 프레임워크:** Jest + React Testing Library
- **테스트 위치:** `__tests__/` 디렉토리
- **E2E 테스트:** Playwright (선택사항)
- **테스트 파일 명명:** `*.test.tsx`, `*.spec.ts`

### Previous Story Insights
Story 1.1, 1.2에서 구현된 내용:
- Supabase 프로젝트 설정 및 환경 구성 완료
- 회원가입/로그인 폼 컴포넌트 및 서버 액션 구현
- 이메일 인증 플로우 구현
- 비밀번호 요구사항: 영문자, 숫자, 특수문자 포함 필수
- Jest + React Testing Library 테스트 환경 구축
- Next.js 미들웨어를 통한 인증 상태 관리

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-13 | 1.0 | 초기 스토리 생성 | Scrum Master |

## Dev Agent Record

### Agent Model Used
*개발 에이전트가 구현 시 기록*

### Debug Log References
*개발 에이전트가 구현 시 기록*

### Completion Notes List
*개발 에이전트가 구현 시 기록*

### File List
**Created:**
- components/auth/reset-password-form.tsx
- components/auth/new-password-form.tsx
- app/auth/reset-password/page.tsx
- app/auth/reset-password/confirm/page.tsx
- __tests__/components/reset-password-form.test.tsx
- __tests__/components/new-password-form.test.tsx

**Modified:**
- app/actions/auth.ts (resetPasswordAction, updatePasswordAction 추가)
- __tests__/actions/auth.test.ts (새 서버 액션 테스트 추가)

## QA Results
*QA 에이전트가 검토 시 기록*

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Completion Notes List
- 비밀번호 재설정 요청 폼 컴포넌트 구현 (components/auth/reset-password-form.tsx)
- 새 비밀번호 설정 폼 컴포넌트 구현 (components/auth/new-password-form.tsx)
- 비밀번호 재설정 관련 서버 액션 구현 (resetPasswordAction, updatePasswordAction)
- 비밀번호 재설정 페이지들 구현 (/auth/reset-password, /auth/reset-password/confirm)
- 실시간 이메일 및 비밀번호 유효성 검사 구현
- 사용자 친화적인 에러 메시지 처리
- 포괄적인 테스트 커버리지 (컴포넌트 및 서버 액션 테스트)
- 총 41개 테스트 통과

### Debug Log References
- 모든 테스트 통과 (41/41)
- Jest 환경에서 window.location.href 에러는 정상 (JSDOM 제한사항)
- Supabase Auth API를 통한 비밀번호 재설정 플로우 구현

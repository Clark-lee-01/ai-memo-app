# Story 2.3: 노트 목록 조회 및 페이지네이션

## Status
Ready for Review

## Story
**As a** 사용자,
**I want** 내가 작성한 모든 노트를 목록으로 조회하고 페이지네이션으로 탐색할 수 있도록,
**so that** 많은 노트를 효율적으로 관리하고 원하는 노트를 빠르게 찾을 수 있다

## Acceptance Criteria
1. 로그인한 사용자의 노트 목록이 표시된다
2. 노트는 최신순으로 정렬되어 표시된다
3. 각 노트 항목은 제목, 본문 미리보기(100자), 작성일시를 포함한다
4. 페이지당 20개의 노트가 표시된다
5. 페이지네이션 UI(이전/다음 버튼, 페이지 번호)가 제공된다
6. 노트가 없을 경우 빈 상태 UI가 표시된다
7. 노트 항목 클릭 시 노트 상세 페이지로 이동한다
8. 로딩 상태가 표시된다
9. 에러 발생 시 적절한 에러 메시지가 표시된다
10. 새 노트 작성 버튼이 제공된다

## Tasks / Subtasks
- [x] 노트 목록 조회 API 구현 (AC: 1, 2, 4)
  - [x] Server Action으로 노트 목록 조회 로직 구현
  - [x] Drizzle ORM을 활용한 페이지네이션 쿼리
  - [x] 사용자별 노트 필터링
  - [x] 정렬 로직 구현 (최신순)
  - [x] 전체 개수 조회 및 페이지 계산
- [x] 노트 목록 페이지 UI 구현 (AC: 3, 5, 7, 10)
  - [x] 노트 목록 페이지 컴포넌트 생성
  - [x] 노트 항목 카드 컴포넌트 구현
  - [x] 페이지네이션 컴포넌트 구현
  - [x] 새 노트 작성 버튼 추가
  - [x] 반응형 레이아웃 구현
- [x] 빈 상태 UI 구현 (AC: 6)
  - [x] 노트 없음 상태 컴포넌트 생성
  - [x] 첫 노트 작성 유도 메시지 및 버튼
- [x] 로딩 및 에러 처리 (AC: 8, 9)
  - [x] 로딩 스켈레톤 UI 구현
  - [x] 에러 바운더리 및 에러 메시지 표시
  - [x] 재시도 기능 구현
- [x] 노트 목록 테스트 작성 (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
  - [x] 노트 목록 조회 API 테스트
  - [x] 페이지네이션 로직 테스트
  - [x] UI 렌더링 테스트
  - [x] 빈 상태 테스트
  - [x] 에러 처리 테스트

## Dev Notes

### Previous Story Insights
[Source: Story 2.2]
- 노트 생성 기능 완료 (제목 + 본문)
- Server Actions 패턴 확립 (`app/actions/notes.ts`)
- Drizzle ORM 기반 데이터 처리 검증
- shadcn/ui 컴포넌트 활용 (Card, Alert, Input, Textarea)
- Zod 스키마 기반 유효성 검사 적용
- `redirect()` 문제 해결: 성공 시 클라이언트에서 `router.push()` 사용

### 기술 스택 정보
[Source: architecture.md#1]
- **프레임워크:** Next.js (App Router, Server Actions)
- **UI:** shadcn/ui + Tailwind + Radix UI
- **DB/인증:** Supabase (Postgres, Auth, Storage)
- **ORM:** Drizzle ORM (마이그레이션/쿼리)
- **호스팅:** Vercel (Preview/Prod)

### 데이터 모델
[Source: Story 2.1, architecture.md#2]
```typescript
// notes 테이블 스키마
export const notes = pgTable('notes', {
  id: uuid('id').primaryKey().defaultRandom(),
  userId: uuid('user_id').notNull().references(() => users.id, { onDelete: 'cascade' }),
  title: text('title').notNull(),
  content: text('content'),
  createdAt: timestamp('created_at', { withTimezone: true }).defaultNow().notNull(),
  updatedAt: timestamp('updated_at', { withTimezone: true }).defaultNow().notNull(),
});
```

### API 명세
[Source: architecture.md#4]
- **엔드포인트:** GET `/notes` (Server Action: `getNotes`)
- **인증:** Supabase Auth 세션 기반
- **데이터베이스:** Supabase Postgres (Drizzle ORM)
- **권한:** 사용자 ID 스코프로 자신의 노트만 조회 가능
- **페이지네이션:**
  - 페이지당 20개 항목
  - offset 기반 페이지네이션
  - 전체 개수 조회 포함

### 컴포넌트 명세
- **노트 목록 페이지:** `app/notes/page.tsx`
- **노트 항목 카드:** `components/notes/note-card.tsx`
- **페이지네이션:** `components/notes/pagination.tsx`
- **빈 상태:** `components/notes/empty-state.tsx`
- **로딩 상태:** `app/notes/loading.tsx`
- **에러 처리:** 기존 에러 핸들링 시스템 활용

### 파일 위치
- 노트 목록 페이지: `app/notes/page.tsx`
- 노트 목록 로딩: `app/notes/loading.tsx`
- 노트 항목 카드: `components/notes/note-card.tsx`
- 페이지네이션: `components/notes/pagination.tsx`
- 빈 상태: `components/notes/empty-state.tsx`
- 노트 Server Actions: `app/actions/notes.ts` (getNotes 함수 추가)
- 노트 타입 정의: `lib/types/notes.ts` (NoteListResponse 타입 추가)
- 노트 유효성 검사: `lib/validations/notes.ts` (noteListOptions 스키마 추가)
- 테스트: `__tests__/components/notes/note-card.test.tsx`, `__tests__/pages/notes/index.test.tsx`

### 보안 고려사항
[Source: architecture.md#3]
- **인증:** 로그인한 사용자만 노트 목록 조회 가능
- **권한:** RLS 정책으로 사용자별 데이터 격리
- **데이터 노출:** 노트 본문은 100자로 제한하여 미리보기만 제공
- **성능:** 인덱스 활용 및 페이지네이션으로 대량 데이터 처리

### 이전 스토리에서의 중요 사항
[Source: Story 1.1-1.7, 2.1-2.2]
- Next.js 15에서는 `cookies()`, `searchParams` 등 동적 API를 `await`해야 함
- Server Component에서 Client Component로 이벤트 핸들러를 props로 전달할 수 없음
- 클라이언트 컴포넌트는 `'use client'` 지시어 필요
- 에러 처리는 기존 에러 핸들링 시스템 활용
- Drizzle ORM 쿼리 패턴 확립 (`db.select().from(notes).where()...`)

### 사용자 경험 고려사항
- **빠른 로딩:** 페이지네이션으로 초기 로딩 시간 최소화
- **시각적 계층:** 제목을 강조하고 본문은 미리보기로 제공
- **직관적 네비게이션:** 명확한 페이지네이션 UI
- **빈 상태:** 첫 노트 작성을 유도하는 친근한 메시지
- **접근성:** 키보드 네비게이션 및 스크린 리더 지원
- **반응형 디자인:** 모바일과 데스크톱 모두 최적화

### Testing

#### 테스트 파일 위치
- 컴포넌트 테스트: `__tests__/components/notes/note-card.test.tsx`
- 페이지 테스트: `__tests__/pages/notes/index.test.tsx`
- 액션 테스트: `__tests__/actions/notes.test.ts` (getNotes 테스트 추가)

#### 테스트 표준
[Source: Story 1.1-1.7, 2.1-2.2]
- **프레임워크:** Jest + React Testing Library
- **실행 명령:** `pnpm test`
- **커버리지:** 모든 주요 기능에 대한 단위 테스트 및 통합 테스트 작성

#### 이 스토리의 특정 테스트 요구사항
- 노트 목록 조회 API 테스트 (페이지네이션, 정렬, 필터링)
- 노트 항목 카드 렌더링 테스트
- 페이지네이션 동작 테스트 (이전/다음 버튼, 페이지 번호)
- 빈 상태 UI 테스트
- 로딩 및 에러 처리 테스트
- 노트 클릭 시 상세 페이지 이동 테스트

### 추가 구현 세부사항

#### 페이지네이션 전략
- **방식:** offset 기반 페이지네이션
- **페이지당 항목 수:** 20개
- **쿼리 최적화:** Drizzle ORM의 `limit()`, `offset()` 활용
- **전체 개수:** `count()` 쿼리로 전체 페이지 수 계산

#### UI 컴포넌트
- **노트 카드:** shadcn/ui Card 컴포넌트 활용
- **페이지네이션:** 이전/다음 버튼 + 페이지 번호 표시
- **빈 상태:** 일러스트레이션 또는 아이콘 + 메시지 + CTA 버튼
- **로딩:** 스켈레톤 UI로 로딩 상태 표시

#### 성능 고려사항
- 인덱스 활용 (userId, createdAt)
- 쿼리 최적화 (필요한 필드만 조회)
- 클라이언트 사이드 캐싱 고려 (React Query 등)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-14 | 1.0 | 초기 스토리 생성 | Bob (SM) |
| 2025-01-14 | 1.1 | 노트 목록 조회 및 페이지네이션 구현 완료 | James (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
- 노트 목록 조회 Server Action (getNotes) 구현 완료
- 페이지네이션 UI 컴포넌트 구현 완료
- 노트 카드 컴포넌트 구현 완료
- 빈 상태 UI 구현 완료
- 로딩 스켈레톤 UI 구현 완료
- date-fns 라이브러리 설치 완료
- shadcn/ui Skeleton 컴포넌트 추가 완료
- 컴포넌트 테스트 (note-card, pagination, empty-state) 작성 및 통과 (32개 테스트)

### Completion Notes List
- ✅ Server Action `getNotes` 구현 (페이지네이션, 정렬, 검색 지원)
- ✅ 노트 목록 페이지 `app/notes/page.tsx` 구현
- ✅ 노트 카드 컴포넌트 `components/notes/note-card.tsx` 구현
- ✅ 페이지네이션 컴포넌트 `components/notes/pagination.tsx` 구현
- ✅ 빈 상태 컴포넌트 `components/notes/empty-state.tsx` 구현
- ✅ 로딩 상태 `app/notes/loading.tsx` 구현
- ✅ date-fns를 활용한 날짜 포맷팅 (상대 시간 표시)
- ✅ 페이지당 20개 노트 표시
- ✅ offset 기반 페이지네이션
- ✅ 최신순 정렬 (createdAt DESC)
- ✅ 반응형 그리드 레이아웃 (모바일: 1열, 태블릿: 2열, 데스크톱: 3열)
- ✅ 컴포넌트 테스트 작성 및 통과

### File List
- app/notes/page.tsx (신규)
- app/notes/loading.tsx (신규)
- components/notes/note-card.tsx (신규)
- components/notes/pagination.tsx (신규)
- components/notes/empty-state.tsx (신규)
- components/ui/skeleton.tsx (신규)
- app/actions/notes.ts (getNotes 함수 추가)
- lib/types/notes.ts (NoteListResponse 타입 이미 정의됨)
- lib/validations/notes.ts (noteListOptionsSchema 이미 정의됨)
- __tests__/components/notes/note-card.test.tsx (신규)
- __tests__/components/notes/pagination.test.tsx (신규)
- __tests__/components/notes/empty-state.test.tsx (신규)
- package.json (date-fns 의존성 추가)

## QA Results
*QA 검토 후 기록됩니다*


# Story 2.2: 노트 생성 (제목 + 본문)

## Status
Ready for Review

## Story
**As a** 사용자,
**I want** 제목과 본문을 포함한 노트를 생성할 수 있도록,
**so that** 중요한 정보를 체계적으로 기록하고 관리할 수 있다

## Acceptance Criteria
1. 노트 작성 페이지에 접근할 수 있다
2. 제목과 본문을 입력할 수 있는 폼이 제공된다
3. 제목은 필수 입력 항목이며 최대 100자까지 입력 가능하다
4. 본문은 선택 입력 항목이며 최대 10,000자까지 입력 가능하다
5. 노트 저장 시 유효성 검사가 수행된다
6. 저장 성공 시 노트 목록 페이지로 리다이렉트된다
7. 저장 실패 시 적절한 에러 메시지가 표시된다
8. 저장 중 로딩 상태가 표시된다
9. 취소 버튼으로 작성 중인 내용을 포기할 수 있다

## Tasks / Subtasks
- [x] 노트 생성 페이지 구현 (AC: 1, 2)
  - [x] 노트 작성 폼 컴포넌트 생성
  - [x] 제목 입력 필드 구현
  - [x] 본문 입력 필드 구현 (textarea)
  - [x] 폼 레이아웃 및 스타일링
- [x] 입력 유효성 검사 구현 (AC: 3, 4, 5)
  - [x] 제목 필수 입력 검증
  - [x] 제목 최대 길이 검증 (100자)
  - [x] 본문 최대 길이 검증 (10,000자)
  - [x] 실시간 유효성 검사 및 에러 표시
- [x] 노트 저장 기능 구현 (AC: 6, 7, 8)
  - [x] Server Action으로 노트 저장 로직 구현
  - [x] Drizzle ORM을 활용한 데이터베이스 저장
  - [x] 저장 성공 시 리다이렉트 처리
  - [x] 저장 실패 시 에러 메시지 표시
  - [x] 로딩 상태 관리 및 UI 표시
- [x] 사용자 경험 개선 (AC: 9)
  - [x] 취소 버튼 구현
  - [x] 확인 다이얼로그 표시
  - [x] 폼 초기화 기능
- [x] 노트 생성 테스트 작성 (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9)
  - [x] 폼 렌더링 테스트
  - [x] 유효성 검사 테스트
  - [x] 저장 기능 테스트
  - [x] 에러 처리 테스트
  - [x] 사용자 상호작용 테스트

## Dev Notes

### Previous Story Insights
- 에픽 1에서 사용자 인증 시스템 완료
- 스토리 2.1에서 DrizzleORM 환경 및 데이터베이스 스키마 구성 완료
- Next.js App Router와 Supabase Postgres 연동 완료

### 기술 스택 정보
[Source: architecture.md#1]
- **프레임워크:** Next.js (App Router, Server Actions)
- **UI:** shadcn/ui + Tailwind + Radix UI
- **DB/인증:** Supabase (Postgres, Auth, Storage)
- **ORM:** Drizzle ORM (마이그레이션/쿼리)
- **호스팅:** Vercel (Preview/Prod)

### 데이터 모델
[Source: Story 2.1]
```typescript
// notes 테이블 스키마
export const notes = pgTable('notes', {
  id: uuid('id').primaryKey().defaultRandom(),
  userId: uuid('user_id').notNull().references(() => users.id, { onDelete: 'cascade' }),
  title: text('title').notNull(),
  content: text('content'),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});
```

### API 명세
- **엔드포인트:** POST `/api/notes` (Server Action)
- **인증:** Supabase Auth 세션 기반
- **데이터베이스:** Supabase Postgres (Drizzle ORM)
- **RLS 정책:** 사용자별 노트 접근 제한

### 컴포넌트 명세
- **노트 작성 폼:** `components/notes/note-form.tsx`
- **노트 작성 페이지:** `app/notes/new/page.tsx`
- **유효성 검사:** Zod 스키마 활용
- **에러 처리:** 기존 에러 핸들링 시스템 활용

### 파일 위치
- 노트 작성 페이지: `app/notes/new/page.tsx`
- 노트 폼 컴포넌트: `components/notes/note-form.tsx`
- 노트 Server Actions: `app/actions/notes.ts`
- 노트 타입 정의: `lib/types/notes.ts`
- 노트 유효성 검사: `lib/validations/notes.ts`
- 테스트: `__tests__/components/notes/note-form.test.tsx`, `__tests__/actions/notes.test.ts`

### 보안 고려사항
[Source: architecture.md#3]
- **인증:** 로그인한 사용자만 노트 생성 가능
- **권한:** RLS 정책으로 사용자별 데이터 격리
- **입력 검증:** XSS 방지를 위한 입력 sanitization
- **데이터 무결성:** 제목 필수 입력, 길이 제한

### 이전 스토리에서의 중요 사항
[Source: Story 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7]
- Next.js 15에서는 `cookies()`, `searchParams` 등 동적 API를 `await`해야 함
- Server Component에서 Client Component로 이벤트 핸들러를 props로 전달할 수 없음
- 클라이언트 컴포넌트는 `'use client'` 지시어 필요
- 에러 처리는 기존 에러 핸들링 시스템 활용

### 사용자 경험 고려사항
- **직관적 인터페이스:** 명확한 제목과 본문 구분
- **실시간 피드백:** 입력 중 유효성 검사 결과 표시
- **접근성:** 키보드 네비게이션 및 스크린 리더 지원
- **반응형 디자인:** 모바일과 데스크톱 모두 지원

### Testing

#### 테스트 파일 위치
- 컴포넌트 테스트: `__tests__/components/notes/note-form.test.tsx`
- 액션 테스트: `__tests__/actions/notes.test.ts`
- 통합 테스트: `__tests__/pages/notes/new.test.tsx`

#### 테스트 표준
- **프레임워크:** Jest + React Testing Library
- **실행 명령:** `pnpm test`
- **커버리지:** 모든 주요 기능에 대한 단위 테스트 및 통합 테스트 작성

#### 테스트 패턴
[Source: Story 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7]
- 폼 렌더링 테스트
- 입력 유효성 검사 테스트
- 서버 액션 호출 테스트
- 에러 처리 테스트
- 사용자 상호작용 테스트

#### 이 스토리의 특정 테스트 요구사항
- 노트 작성 폼 렌더링 테스트
- 제목/본문 입력 및 유효성 검사 테스트
- 노트 저장 성공/실패 시나리오 테스트
- 리다이렉트 동작 테스트
- 취소 기능 테스트

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |
| 2025-01-14 | 1.1 | 노트 생성 기능 구현 완료 | James (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
- 노트 생성 페이지 및 폼 컴포넌트 구현 완료
- Zod 스키마 기반 유효성 검사 구현 완료
- Server Action 기반 노트 저장 로직 구현 완료
- shadcn/ui 컴포넌트 (Input, Textarea, Card, Alert) 추가 완료
- 노트 폼 테스트 작성 및 모든 테스트 통과 확인

### Completion Notes List
- ✅ 노트 타입 및 유효성 검사 정의 (lib/types/notes.ts, lib/validations/notes.ts)
- ✅ 노트 생성 Server Action 구현 (app/actions/notes.ts)
- ✅ 노트 폼 UI 컴포넌트 구현 (components/notes/note-form.tsx)
- ✅ 노트 생성 페이지 구현 (app/notes/new/page.tsx)
- ✅ shadcn/ui 컴포넌트 추가 (Input, Textarea, Card, Alert)
- ✅ 노트 폼 테스트 작성 및 수정 (11개 테스트 모두 통과)
- ✅ 제목 필수 입력 검증 (1-100자)
- ✅ 본문 선택 입력 검증 (최대 10,000자)
- ✅ 실시간 유효성 검사 및 에러 표시
- ✅ 저장 중 로딩 상태 표시
- ✅ 취소 버튼 및 네비게이션 구현

### File List
- lib/types/notes.ts (신규)
- lib/validations/notes.ts (신규)
- app/actions/notes.ts (신규)
- components/notes/note-form.tsx (신규)
- app/notes/new/page.tsx (신규)
- components/ui/input.tsx (신규)
- components/ui/textarea.tsx (신규)
- components/ui/card.tsx (신규)
- components/ui/alert.tsx (신규)
- __tests__/components/notes/note-form.test.tsx (신규)

## QA Results
*QA 검토 후 기록됩니다*
